const express = require('express');const request = require('request');const cheerio = require('cheerio');// const iconv = require('iconv-lite');const mongoose = require('mongoose');const infoMode = require('./model/info')const axios = require('axios');var app = express();// let db =  mongoose.connect('mongodb://localhost/nodeSpider');//// db.connection.on('error', function (err) {console.log('err..', err.message)});// db.connection.on('connected', function () {console.log('链接成功...');});// db.connection.on('disconnected', function () {console.log('链接断开...');});// let url = 'https://timeline-merger-ms.juejin.im/v1/get_entry_by_rank?src=web&before=0.55559783863408&limit=20&category=5562b419e4b00c57d9b94ae2'let url = 'https://juejin.im/welcome/backend';app.get('/', (req, res) => {	// 获取html内容	request(url, (err, response, body) => {		if (!err && response.statusCode == 200) {			let $ = cheerio.load(body);			let titles = $('.info-box a.title');			let list = []			for (let i = 0, len = titles.length; i < len; i++) {				let data ={};				let title = $(titles[i]).text(),					href = $(titles[i]).attr('href');				data.title = title;				data.href = 'https://juejin.im' + href;				list.push(data);			}			res.send(list)		} else {			res.send('spider fail')			// console.log('err:', err)		}	});	// res.send('success')	// 获取接口数据	// axios.get(url)	// 	.then(response => {	// 		console.log('res:', response.data.d.entrylist);	// 		res.send(response.data.d.entrylist)	// 	})});var server = app.listen(3333, function () {	var host = server.address().address;	var port = server.address().port;	console.log('Example app listening at http://%s:%s', host, port);});